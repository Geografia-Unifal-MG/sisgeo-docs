version: '3.4'
services:
    gsmaster:
      image: terrabrasilis/geoserver-master:v1.0.6
      hostname: master.geoserver
      ports:
        - "8888:8080"
      #healthcheck:
        #test: curl -f http://10.254.254.150/geoserver || exit 1
        #test: curl -f http://localhost:8080/geoserver || exit 1
        #interval: 1m30s
        #timeout: 10s
        #retries: 3
        #start_period: 5m
      networks:
        - bridge
      volumes:
        - /server/sisgeo/data/geoserver-cluster/gs_datadir:/var/local/geoserver
        - /server/sisgeo/data/geoserver-cluster/gs_extensions:/var/local/geoserver-exts
        - /server/sisgeo/data/geoserver-cluster/gs_webconfig/web.xml:/usr/local/geoserver/WEB-INF/web.xml
      environment:
        COOKIE: JSESSIONID prefix
        CLUSTER_CONFIG_DIR: /var/local/geoserver/cluster/master
        GEOSERVER_LOG_LOCATION: /var/local/geoserver/logs/geoserver.log
        CATALINA_OPTS: >-
          -XX:OnOutOfMemoryError="kill -9 %p"
          -Djava.awt.headless=true
          -Dfile.encoding=UTF-8
          -server -Xms1024m -Xmx3072m -Xss1024k -XX:NewSize=768m -XX:+UseParallelGC -XX:MaxGCPauseMillis=500
          -DGEOSERVER_DATA_DIR=/var/local/geoserver
        instanceName: master
      deploy:
        replicas: 1
        restart_policy:
          condition: any

networks:
  bridge:
    external: true
